#include "raylib.h"
#include <cmath>

struct Ball {
    float x, y;
    float vx, vy;
    float radius;
    Color color;
};

int main() {
    const int screenWidth = 800;
    const int screenHeight = 600;

    InitWindow(screenWidth, screenHeight, "2 Ball Collision");
    SetTargetFPS(60);

    Ball ball1 = {200, 300, 4, 2, 40, RED};
    Ball ball2 = {600, 300, -3, -2, 40, BLUE};

    while (!WindowShouldClose()) {
        // ----------------------------
        // 1. Update posisi bola
        // ----------------------------
        ball1.x += ball1.vx;
        ball1.y += ball1.vy;

        ball2.x += ball2.vx;
        ball2.y += ball2.vy;

        // ----------------------------
        // 2. Tabrakan dengan dinding
        // ----------------------------
        auto bounceWall = [&](Ball &b) {
            if (b.x - b.radius <= 0 || b.x + b.radius >= screenWidth)
                b.vx *= -1;
            if (b.y - b.radius <= 0 || b.y + b.radius >= screenHeight)
                b.vy *= -1;
        };

        bounceWall(ball1);
        bounceWall(ball2);

        // ----------------------------
        // 3. Collision antar bola
        // ----------------------------
        float dx = ball2.x - ball1.x;
        float dy = ball2.y - ball1.y;
        float distance = sqrt(dx*dx + dy*dy);

        if (distance <= ball1.radius + ball2.radius) {
            // Normalisasi arah tumbukan
            float nx = dx / distance;
            float ny = dy / distance;

            // Project velocity ke normal direction
            float p1 = ball1.vx * nx + ball1.vy * ny;
            float p2 = ball2.vx * nx + ball2.vy * ny;

            // Tukar komponen kecepatan sepanjang normal (elastic collision)
            float temp = p1;
            p1 = p2;
            p2 = temp;

            // Update velocity setelah collision
            ball1.vx += (p1 - temp) * nx;
            ball1.vy += (p1 - temp) * ny;

            ball2.vx += (p2 - p2) * nx;
            ball2.vy += (p2 - p2) * ny;

            // Pisahkan bola supaya tidak "menyatu"
            float overlap = (ball1.radius + ball2.radius) - distance;
            ball1.x -= nx * overlap / 2;
            ball2.x += nx * overlap / 2;
            ball1.y -= ny * overlap / 2;
            ball2.y += ny * overlap / 2;
        }

        // ----------------------------
        // Drawing
        // ----------------------------
        BeginDrawing();
        ClearBackground(RAYWHITE);

        DrawCircle(ball1.x, ball1.y, ball1.radius, ball1.color);
        DrawCircle(ball2.x, ball2.y, ball2.radius, ball2.color);

        EndDrawing();
    }

    CloseWindow();
    return 0;
}
